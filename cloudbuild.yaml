steps:
  # Step 1: Read or initialize the version from version.txt
  - name: 'ubuntu'
    id: ReadVersion
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        if [ ! -f version.txt ]; then
          echo "v1" > version.txt  # Initialize version if file does not exist
        fi
        VERSION=$(cat version.txt)
        echo "VERSION=${VERSION}" > /workspace/version.env
        echo "Current version: $VERSION"

  # Step 2: Increment the version
  - name: 'ubuntu'
    id: IncrementVersion
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        current_version=$(cat version.txt)
        echo "Current version before increment: $current_version"
        # Simple version increment logic
        IFS='.' read -r major minor patch <<< "$current_version"
        patch=$((patch + 1))
        new_version="$major.$minor.$patch"
        echo "$new_version" > version.txt
        echo "New version after increment: $new_version"

options:
  logging: CLOUD_LOGGING_ONLY  # Use this logging option to avoid the error

# Optional: Specify a timeout
timeout: '1200s'  # Adjust the timeout as needed
